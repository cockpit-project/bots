#!/bin/sh

set -eu

test_ruff() {
    command -v ruff >/dev/null || { echo 'no ruff installed'; return 0; }
    test -n "$(ruff check --show-files .)" || return 0  # no python changes
    ruff check --no-cache .
}


if [ -z "${SKIP_STATIC_CHECK:-}" ]; then
    test_ruff

    # run static code checks like flake8 and mypy
    PYEXEFILES="$(echo $(git grep -lI '^#!.*python') $(git ls-files "*.py") | xargs -n 1 | sort -u)"
    flake8 $PYEXEFILES

    mypy --no-error-summary .
fi

./test-bots
